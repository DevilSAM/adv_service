import{d as F,e as c,x as M,y as b,b as S,c as p,a as t,w as l,u as E,k as L,r,o as i,i as T,z as q,t as z,F as O,l as j,h as w,q as v,s as G,E as g,A as H,_ as J}from"./app-B0wpD2Za.js";import{u as K,A as P}from"./useAdvert-Dn0vfqZA.js";import{u as Q,a as W}from"./useRules-CkGS_ocY.js";const X={class:"common-layout"},Y={class:"card-header"},Z={key:0},ee={key:1},ae=3,te=F({__name:"AdvertCreate",setup(le){E();const x=L(),_=c(!1),f=c(),{createAdvert:A}=K(),{isUpdate:h}=Q(),C=c(W);M(()=>o.value.id?`Объявление № ${o.value.id}`:"Новое");const o=c(new P),u=b({images:[{key:1,value:""}]});S(()=>{o.value.images=[]});const y=m=>{m&&m.validate(async e=>{var d,n;if(!e)return!1;u.images.length&&(o.value.images=u.images.filter(s=>s.value).map(s=>s.value));try{_.value=!0;const{data:s}=await A(o.value);console.log("DATA: ",s),g.success({message:"Данные сохранены"}),await x.push({name:"AdvertCard",params:{id:s.id}})}catch(s){g.error({message:(n=(d=s.response)==null?void 0:d.data)==null?void 0:n.message}),console.log(s)}finally{_.value=!1}}).catch(()=>{g.error({message:"Проверьте правильность заполнения полей!"})})};b({domains:[""],email:""});const U=m=>{const e=u.images.indexOf(m);e!==-1&&u.images.splice(e,1)},R=()=>{u.images.push({key:Date.now(),value:""})};return(m,e)=>{const d=r("el-input"),n=r("el-form-item"),s=r("el-button"),$=r("el-input-number"),B=r("el-form"),I=r("el-card"),N=r("el-main"),D=r("el-container");return i(),p("div",X,[t(D,null,{default:l(()=>[t(N,null,{default:l(()=>[t(I,{shadow:"always",class:"box-card mt-5 text-center mx-auto w-50"},{header:l(()=>[T("div",Y,[q(h)()?(i(),p("h2",Z,z(o.value.title),1)):(i(),p("h2",ee,"Создать объявление"))])]),default:l(()=>[t(B,{model:o.value,ref_key:"formRef",ref:f,rules:C.value,"label-width":"120px"},{default:l(()=>[t(n,{label:"Название",prop:"title"},{default:l(()=>[t(d,{modelValue:o.value.title,"onUpdate:modelValue":e[0]||(e[0]=a=>o.value.title=a)},null,8,["modelValue"])]),_:1}),t(n,{label:"Описание",prop:"description"},{default:l(()=>[t(d,{modelValue:o.value.description,"onUpdate:modelValue":e[1]||(e[1]=a=>o.value.description=a),type:"textarea",rows:4},null,8,["modelValue"])]),_:1}),(i(!0),p(O,null,j(u.images,(a,k)=>(i(),w(n,{key:a.key,label:`Фото ${k+1}`,prop:"images."+k+".value"},{default:l(()=>[t(d,{modelValue:a.value,"onUpdate:modelValue":V=>a.value=V},null,8,["modelValue","onUpdate:modelValue"]),t(s,{class:"mt-2",onClick:H(V=>U(a),["prevent"])},{default:l(()=>[v(" Удалить ")]),_:2},1032,["onClick"])]),_:2},1032,["label","prop"]))),128)),t(n,null,{default:l(()=>{var a;return[((a=u.images)==null?void 0:a.length)<ae?(i(),w(s,{key:0,onClick:R},{default:l(()=>[v(" Добавить фото ")]),_:1})):G("",!0)]}),_:1}),t(n,{label:"Цена",prop:"price"},{default:l(()=>[t($,{modelValue:o.value.price,"onUpdate:modelValue":e[2]||(e[2]=a=>o.value.price=a),step:100},null,8,["modelValue"])]),_:1}),t(n,null,{default:l(()=>[t(s,{type:"primary",disabled:_.value,onSubmit:e[3]||(e[3]=a=>y(f.value)),onClick:e[4]||(e[4]=a=>y(f.value))},{default:l(()=>[v("Сохранить")]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1})]),_:1})])}}}),re=J(te,[["__scopeId","data-v-4180c4ff"]]);export{re as default};
